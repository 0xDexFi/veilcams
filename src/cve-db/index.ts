import type { CveCheck, CameraVendor } from '../types/index.js';
import { hikvisionChecks } from './hikvision.js';
import { dahuaChecks } from './dahua.js';
import { axisChecks } from './axis.js';
import { genericChecks } from './generic.js';

const ALL_CVE_CHECKS: CveCheck[] = [
  ...hikvisionChecks,
  ...dahuaChecks,
  ...axisChecks,
  ...genericChecks,
];

/**
 * Get applicable CVE checks for a given vendor.
 * Returns vendor-specific checks + all generic checks.
 */
export function getCveChecksForVendor(vendor: CameraVendor): CveCheck[] {
  const vendorChecks = ALL_CVE_CHECKS.filter(
    (c) => c.vendor === vendor || c.vendor === 'generic'
  );

  // Deduplicate by cveId
  const seen = new Set<string>();
  return vendorChecks.filter((c) => {
    if (seen.has(c.cveId)) return false;
    seen.add(c.cveId);
    return true;
  });
}

/**
 * Get all registered CVE checks.
 */
export function getAllCveChecks(): CveCheck[] {
  return [...ALL_CVE_CHECKS];
}

export { hikvisionChecks, dahuaChecks, axisChecks, genericChecks };
